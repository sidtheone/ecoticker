{
  "project": {
    "name": "ecoticker",
    "description": "Environmental news impact tracker with stock-ticker style UI",
    "version": "0.1.0",
    "generated": "2026-02-13T00:00:00Z",
    "branch": "v2",
    "repository": "github.com/sidtheone/ecoticker"
  },
  "stack": {
    "framework": "Next.js 16.1.6",
    "runtime": "React 19.2.3",
    "language": "TypeScript 5",
    "styling": "Tailwind CSS 4",
    "database": "PostgreSQL 17 + Drizzle ORM",
    "charts": "Recharts 3.7",
    "validation": "Zod 4.3.6",
    "containerization": "Docker + Docker Compose"
  },
  "entry_points": {
    "dev_server": {
      "command": "npm run dev",
      "port": 3000,
      "description": "Development server with hot reload"
    },
    "production": {
      "command": "docker compose up -d",
      "port": 80,
      "description": "Production stack (app + nginx + cron)"
    },
    "batch_pipeline": {
      "command": "npx tsx scripts/batch.ts",
      "description": "Manual batch processing (NewsAPI → LLM → DB)"
    },
    "seed_data": {
      "command": "npx tsx scripts/seed.ts",
      "description": "Seed database with demo data"
    },
    "tests": {
      "command": "npx jest",
      "description": "Run all 132 tests across 17 suites"
    }
  },
  "structure": {
    "src/app": {
      "purpose": "Next.js App Router pages and API routes",
      "key_files": [
        "layout.tsx",
        "page.tsx",
        "globals.css",
        "topic/[slug]/page.tsx"
      ],
      "api_routes": [
        "api/topics/route.ts",
        "api/topics/[slug]/route.ts",
        "api/ticker/route.ts",
        "api/movers/route.ts",
        "api/articles/route.ts",
        "api/articles/[id]/route.ts",
        "api/batch/route.ts",
        "api/seed/route.ts",
        "api/cleanup/route.ts",
        "api/audit-logs/route.ts",
        "api/cron/batch/route.ts"
      ]
    },
    "src/components": {
      "purpose": "React components for UI",
      "exports": [
        "ThemeProvider",
        "ThemeToggle",
        "TickerBar",
        "TopicGrid",
        "TopicCard",
        "BiggestMovers",
        "RefreshButton",
        "Sparkline",
        "ScoreChart",
        "ArticleList",
        "UrgencyBadge"
      ]
    },
    "src/lib": {
      "purpose": "Core utilities and business logic",
      "modules": {
        "types.ts": "TypeScript type definitions",
        "utils.ts": "Color/format utilities for scores",
        "auth.ts": "API key authentication",
        "rate-limit.ts": "In-memory rate limiter",
        "validation.ts": "Zod schemas for input validation",
        "errors.ts": "Centralized error handling",
        "events.ts": "EventMap type + eventBus for cross-component events",
        "audit-log.ts": "Audit logging utilities"
      }
    },
    "src/db": {
      "purpose": "Database connection and schema",
      "modules": {
        "index.ts": "Drizzle connection pool (PostgreSQL via pg library)",
        "schema.ts": "Drizzle schema definitions for all tables"
      }
    },
    "src/middleware.ts": {
      "purpose": "Next.js middleware for CSP headers and rate limiting"
    },
    "scripts": {
      "purpose": "Automation scripts",
      "files": {
        "batch.ts": "Daily pipeline: NewsAPI → LLM classify → LLM score → DB",
        "seed.ts": "Seeds 12 topics, 36 articles, 84 score history entries",
        "setup-git-hooks.sh": "Installs pre-commit hooks for build checks"
      }
    },
    "drizzle.config.ts": {
      "purpose": "Drizzle Kit configuration for schema migrations"
    },
    "tests": {
      "purpose": "Test suites with Jest",
      "coverage": "98.6% statement coverage",
      "suites": 17,
      "tests": 132,
      "files": [
        "db.test.ts",
        "utils.test.ts",
        "batch.test.ts",
        "seed.test.ts",
        "api-topics.test.ts",
        "api-topic-detail.test.ts",
        "api-ticker.test.ts",
        "api-movers.test.ts",
        "api-cron-batch.test.ts",
        "TickerBar.test.tsx",
        "TopicCard.test.tsx",
        "TopicGrid.test.tsx",
        "BiggestMovers.test.tsx",
        "Sparkline.test.tsx",
        "ScoreChart.test.tsx",
        "ArticleList.test.tsx",
        "TopicDetail.test.tsx"
      ]
    },
    "docs": {
      "purpose": "Documentation and design documents",
      "files": {
        "TOKEN_EFFICIENCY_REPORT.md": "Token savings analysis and ROI",
        "real-data-setup.md": "Guide for connecting real NewsAPI data",
        "refresh-button-design.md": "RefreshButton component design",
        "refresh-button-implementation-summary.md": "RefreshButton implementation notes",
        "ui-refresh-design.md": "UI refresh feature design"
      },
      "plans": {
        "2026-02-09-business-panel-analysis.md": "9-expert business panel, 10 recommendations",
        "2026-02-09-user-stories.md": "Original 23 user stories (SUPERSEDED)",
        "2026-02-09-llm-scoring-research.md": "LLM scoring strategy (v3, 30+ sources)",
        "2026-02-12-user-stories-v2.md": "Deep revision: 20 stories, personas + journeys",
        "2026-02-12-postgresql-drizzle-design.md": "PostgreSQL + Drizzle ORM design for v2"
      }
    }
  },
  "api": {
    "public_endpoints": [
      {
        "path": "/api/topics",
        "method": "GET",
        "params": ["urgency", "category"],
        "response": "{ topics: Topic[] }"
      },
      {
        "path": "/api/topics/[slug]",
        "method": "GET",
        "response": "{ topic, articles, scoreHistory }"
      },
      {
        "path": "/api/ticker",
        "method": "GET",
        "response": "{ items: TickerItem[] }"
      },
      {
        "path": "/api/movers",
        "method": "GET",
        "response": "{ movers[] }"
      },
      {
        "path": "/api/articles",
        "method": "GET",
        "params": ["topicId", "source", "url", "limit", "offset"],
        "response": "{ articles[], pagination }"
      },
      {
        "path": "/api/articles/[id]",
        "method": "GET",
        "response": "{ article, topic }"
      }
    ],
    "protected_endpoints": [
      {
        "path": "/api/seed",
        "method": "POST",
        "auth": "X-API-Key header",
        "description": "Seed database with demo data"
      },
      {
        "path": "/api/batch",
        "method": "POST",
        "auth": "X-API-Key header",
        "description": "Run batch processing manually"
      },
      {
        "path": "/api/cleanup",
        "method": "POST",
        "auth": "X-API-Key header",
        "description": "Clean up demo/seed data"
      },
      {
        "path": "/api/articles",
        "method": "POST",
        "auth": "X-API-Key header",
        "description": "Create new article (Zod validated)"
      },
      {
        "path": "/api/articles",
        "method": "DELETE",
        "auth": "X-API-Key header",
        "description": "Batch delete articles (Zod validated)"
      },
      {
        "path": "/api/articles/[id]",
        "method": "PUT",
        "auth": "X-API-Key header",
        "description": "Update article (Zod validated)"
      },
      {
        "path": "/api/articles/[id]",
        "method": "DELETE",
        "auth": "X-API-Key header",
        "description": "Delete single article"
      },
      {
        "path": "/api/topics",
        "method": "DELETE",
        "auth": "X-API-Key header",
        "description": "Batch delete topics (Zod validated)"
      },
      {
        "path": "/api/audit-logs",
        "method": "GET",
        "auth": "X-API-Key header",
        "description": "View audit logs and statistics"
      }
    ],
    "cron_endpoints": [
      {
        "path": "/api/cron/batch",
        "method": "GET/POST",
        "auth": "Bearer token",
        "description": "Cron-triggered batch processing"
      }
    ]
  },
  "database": {
    "type": "PostgreSQL 17",
    "orm": "Drizzle ORM",
    "library": "pg (node-postgres)",
    "schema": "src/db/schema.ts",
    "connection": "src/db/index.ts",
    "design_doc": "docs/plans/2026-02-12-postgresql-drizzle-design.md",
    "tables": {
      "topics": {
        "key_columns": ["slug (UQ)", "current_score", "previous_score", "urgency", "category", "region"],
        "notes": "Upsert rotates previous_score"
      },
      "articles": {
        "key_columns": ["topic_id (FK)", "url (UQ)", "title", "source", "summary"],
        "notes": "INSERT OR IGNORE for deduplication"
      },
      "score_history": {
        "key_columns": ["topic_id (FK)", "score", "health_score", "eco_score", "econ_score", "recorded_at"],
        "notes": "Daily sub-score snapshots"
      },
      "topic_keywords": {
        "key_columns": ["topic_id (FK)", "keyword"],
        "notes": "LLM-generated aliases for cross-batch matching"
      },
      "audit_logs": {
        "key_columns": ["timestamp", "ip_address", "endpoint", "method", "action", "success", "details"],
        "notes": "Tracks all write operations"
      }
    }
  },
  "external_apis": {
    "NewsAPI": {
      "purpose": "Fetch environmental news",
      "config": "NEWSAPI_KEY",
      "timeout": "15s"
    },
    "OpenRouter": {
      "purpose": "LLM classify and score articles",
      "config": "OPENROUTER_API_KEY, OPENROUTER_MODEL",
      "timeout": "30s"
    }
  },
  "security": {
    "authentication": {
      "method": "API Key (X-API-Key header)",
      "env_var": "ADMIN_API_KEY",
      "scope": "All write operations (POST/PUT/DELETE)"
    },
    "rate_limiting": {
      "read_ops": "100 requests/minute per IP",
      "write_ops": "10 requests/minute per IP",
      "batch_ops": "2 requests/hour per IP",
      "implementation": "In-memory (resets on restart)"
    },
    "input_validation": {
      "library": "Zod 4.3.6",
      "scope": "All write endpoints"
    },
    "sql_injection_protection": "Parameterized queries only",
    "csp": {
      "enabled": true,
      "implementation": "Next.js middleware"
    },
    "audit_logging": {
      "scope": "All write operations",
      "queryable": "GET /api/audit-logs"
    },
    "error_handling": {
      "production": "Sanitized errors",
      "development": "Full error messages",
      "request_ids": true
    }
  },
  "docker": {
    "services": {
      "postgres": {
        "image": "postgres:17-alpine",
        "port": 5432,
        "volume": "pgdata"
      },
      "app": {
        "image": "Dockerfile (multi-stage)",
        "port": 3000,
        "memory": "1GB",
        "depends_on": "postgres"
      },
      "nginx": {
        "image": "nginx:alpine",
        "port": 80
      },
      "cron": {
        "image": "Dockerfile (crond)",
        "schedule": "Daily at 6AM UTC",
        "depends_on": "postgres"
      }
    },
    "volumes": {
      "pgdata": "PostgreSQL data persistence"
    }
  },
  "ci_cd": {
    "platform": "GitHub Actions",
    "workflow": ".github/workflows/security.yml",
    "triggers": ["push to main", "pull request to main"],
    "jobs": [
      "Dependency audit",
      "Security linting",
      "Dockerfile security checks",
      "Full test suite"
    ]
  },
  "v2_planning": {
    "status": "Design phase complete, implementation pending",
    "documents": [
      "Business panel analysis (9 experts, 10 recommendations)",
      "LLM scoring research (v3, 30+ sources)",
      "User stories v2 (20 stories, personas, journeys)",
      "PostgreSQL + Drizzle ORM design"
    ],
    "next_step": "Phase 0: PostgreSQL + Drizzle ORM migration + US-1.1"
  },
  "metrics": {
    "source_files": 35,
    "components": 11,
    "api_routes": 11,
    "lib_modules": 9,
    "test_suites": 17,
    "test_count": 132,
    "test_coverage": "98.6%",
    "status": "v1 complete, v2 design phase done"
  },
  "quick_start": [
    "Clone repository",
    "git checkout v2",
    "Copy .env.example to .env.local and add DATABASE_URL + API keys",
    "npm install",
    "docker compose up -d postgres (start PostgreSQL)",
    "npx drizzle-kit push (create tables)",
    "npx tsx scripts/seed.ts",
    "npm run dev",
    "Visit http://localhost:3000"
  ]
}
