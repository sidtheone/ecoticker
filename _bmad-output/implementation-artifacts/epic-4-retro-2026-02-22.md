# Epic 4 Retrospective: Operational Resilience

**Date:** 2026-02-22
**Facilitator:** Bob (Scrum Master)
**Participants:** Alice (PO), Bob (SM), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev), Sidhartharora (Project Lead)

## Epic Summary

- **Epic:** 4 — Operational Resilience
- **Goal:** Eliminate single point of failure on NewsAPI by integrating curated RSS feeds, add source attribution and feed health monitoring, align route.ts pipeline with US-1.0 rubric
- **Stories Completed:** 6/6 (100%)
- **All stories Size S**
- **Tests:** 276 → 325 (+49 new)
- **Blockers:** 0
- **Production Incidents:** 0
- **Code Reviews:** 6/6 stories reviewed (Stories 4-1 and 4-4 had 2 review passes each)
- **Review Issues Found & Fixed:** ~25 across all stories (3H, ~12M, ~10L)
- **Technical Debt Items:** 3 (pipeline duplication, stale schema default, test file naming)

## Successes

- 100% story completion, zero blockers, zero production incidents — cleanest epic yet
- Dev Notes quality was the best of any epic — exact line numbers, mock patterns, error handling pre-documented
- Epic 3 retro action items followed through: 3/4 completed, 1 in progress (OG image)
- Retro lessons actively cascaded between stories ("mockRestore clears mock.calls" from 4-2 cited in 4-4/4-6 Dev Notes, Commandment XXIV applied in 4-1 pass 2 and 4-2)
- Code review caught ~25 issues — LLM boundary validation was the #1 recurring finding pattern
- Test suite grew 276 → 325 with zero regressions across all 6 stories
- Good teamwork — clean dependency chain (4-1→4-2→4-3/4-4, 4-5→4-6), each story's Dev Notes had "Previous Story Intelligence" section
- Zero-debug stories increased over the epic: 4-3, 4-4, 4-6 all had "None — clean implementation" in debug logs

## Challenges

- **Pipeline duplication** (route.ts + scripts/batch.ts) created SYNC burden in 4/6 stories (4-2, 4-4, 4-5, 4-6). Every code review flagged missing or incomplete SYNC comments.
- **Stale schema default** (`source_type` defaults to `"newsapi"`) — documented as "future cleanup" since Story 4-2, never addressed
- **Test file naming** — `api-batch-gnews.test.ts` became the general batch route test suite (21 tests) but was never renamed
- **Breaking interface changes** — Story 4-4's return type change cascaded across 5 files
- **Three Medium stories in Epic 5** — potential violation of "break M+ into Smalls" agreement (noted but Epic 5 deprioritized)

## Key Insights

1. **Dev Notes quality directly correlates with zero-debug implementations** — Stories with the most thorough Dev Notes (4-3, 4-4, 4-6) had clean implementations with no debugging needed
2. **SYNC comments are a band-aid, not a solution** — Pipeline duplication must be consolidated into a shared module
3. **The "learn and apply" cycle is working** — Retro lessons from earlier stories actively appeared in later story Dev Notes
4. **LLM boundary validation is a systematic weakness** — Every scoring/classification story needed review fixes for undefined/null/NaN guards at the LLM response boundary

## Previous Retrospective Follow-Through (Epic 3)

| Action Item | Owner | Status | Evidence |
|-------------|-------|--------|----------|
| Run `validate-create-story` before every `dev-story` | Bob (SM) | ✅ Completed | All 6 stories had proper story files with full ACs and Dev Notes |
| Add failure-path test requirement for async operations | Dana (QA) | ✅ Completed | Story 4-2 added rejected-promise tests, 4-5 tested non-JSON LLM fallback |
| Include "Error Handling & Edge Cases" in story Dev Notes | Bob (SM) | ✅ Completed | Every story file has explicit error handling sections |
| Replace `og-default.png` with branded image | Sidhartharora | ⏳ In Progress | Design asset — not tracked in sprint-status |

**Team Agreements from Epic 3 — all applied:**
- Code review mandatory ✅
- Small stories preferred ✅
- Dev Notes drive implementation ✅

## Action Items

### Process Improvements

1. **Add "LLM Boundary Validation" as mandatory Dev Notes section for any story touching LLM responses**
   - Owner: Bob (SM)
   - Success criteria: Every LLM-touching story has explicit null/undefined/NaN guards documented before dev

2. **Add pipeline consolidation stories to Epic 7**
   - Owner: Bob (SM)
   - Success criteria: Stories created for shared batch module extraction, schema default fix, test file rename

### Technical Debt (→ Epic 7)

1. **Extract shared batch pipeline module** (`src/lib/batch-pipeline.ts`)
   - Priority: HIGH
   - Consolidates: `fetchRssFeeds()`, `FeedHealth`, `DEFAULT_FEEDS`, `BLOCKED_DOMAINS`, classification prompt, scoring prompt, few-shot examples
   - Eliminates all `// SYNC:` comments

2. **Fix stale schema default** — `source_type` default `"newsapi"` → remove or change to `"unknown"`
   - Priority: MEDIUM

3. **Rename test file** — `api-batch-gnews.test.ts` → `api-batch-route.test.ts`
   - Priority: LOW

### Team Agreements (carried forward + new)

- Code review is mandatory (carried from Epic 3) ✅
- Small stories preferred — break M+ into Smalls (carried from Epic 3) ✅
- Dev Notes drive implementation (carried from Epic 3) ✅
- **NEW: LLM boundary validation section in Dev Notes for all LLM stories**
- **NEW: No more "deferred cleanup" — if debt is identified, create a story immediately**

## Deployment Milestone

**Deploy Epics 4 + 7 together after Epic 7 completion.** No date pressure — quality first. Single release with both the pipeline resilience layer and the UX foundations visual severity layer.

## Next Epic

**Epic 7: UX Foundations** (already in progress)
- 5 UX stories (7-1 through 7-5) + 3 tech debt stories from this retro
- Story 7-3 already done; 7-1 and 7-2 ready-for-dev
- Critical path: `severityColor()` → `SeverityGauge` → Hero → Cards → Detail page
- Dependencies on Epic 4: aligned scoring pipeline, sourceType field, feed health data

## Significant Discoveries

No significant discoveries that fundamentally change Epic 7's plan. Epic 4 delivered cleanly and all prerequisites for Epic 7 are in place. The tech debt stories (pipeline consolidation, schema fix, test rename) are additive to Epic 7, not disruptive.

## Team Performance

Epic 4 delivered 6 stories with steady velocity and improving quality. The retro surfaced 4 key insights, 0 significant discoveries requiring plan changes, and produced 2 process improvements + 3 tech debt stories. The team's "learn and apply" cycle from retro → Dev Notes → implementation is the standout system improvement of this epic.
