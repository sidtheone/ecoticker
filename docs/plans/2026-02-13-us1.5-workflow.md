# US-1.5 Implementation Workflow: Show Category Label on Topic Card

**Date:** 2026-02-13
**Story:** US-1.5 — Show category label on each topic card so visitors can identify the domain at a glance
**Persona:** Dashboard Visitor (casual browser)
**Branch:** `v2`
**Dependencies:** None
**Complexity:** S

---

## Current State Analysis

### What Exists
- `TopicCard` at `src/components/TopicCard.tsx` renders: name, UrgencyBadge, score, change, article count, region, sparkline
- `CATEGORY_LABELS` map defined in `src/components/TopicGrid.tsx` (lines 8-19) — maps snake_case Category to human-readable strings
- `Topic` type already includes `category: Category` — no API changes needed
- `Category` type defined in `src/lib/types.ts` with 10 values
- `UrgencyBadge` component renders a small colored pill for urgency level

### Problems to Solve / Key Design Decisions
1. **CATEGORY_LABELS duplication:** Currently lives only in `TopicGrid.tsx`. Both `TopicGrid` and `TopicCard` need it. Extract to a shared location (`src/lib/utils.ts`).
2. **Visual hierarchy:** Category chip must be visually secondary to the urgency badge — muted colors, smaller font.
3. **Card height:** Must not increase card height; labels should wrap naturally if space is tight.

---

## Target State
- Every topic card shows a muted category pill (e.g., "Air Quality", "Biodiversity") below the topic name row alongside the urgency badge
- `CATEGORY_LABELS` lives in `src/lib/utils.ts` and is imported by both `TopicGrid` and `TopicCard`
- Tests verify the category chip renders with correct label text

---

## Implementation Phases

### Phase 1: Extract CATEGORY_LABELS to shared location (~10 lines)
**File:** `src/lib/utils.ts`
**Changes:**
1. Add import of `Category` type from `./types`
2. Add `CATEGORY_LABELS` export:
```ts
export const CATEGORY_LABELS: Record<Category, string> = {
  air_quality: "Air Quality",
  deforestation: "Deforestation",
  ocean: "Ocean",
  climate: "Climate",
  pollution: "Pollution",
  biodiversity: "Biodiversity",
  wildlife: "Wildlife",
  energy: "Energy",
  waste: "Waste",
  water: "Water",
};
```

### Phase 2: Update TopicGrid to import from shared location (~3 lines)
**File:** `src/components/TopicGrid.tsx`
**Changes:**
1. Remove the local `CATEGORY_LABELS` definition (lines 8-19)
2. Add import: `import { CATEGORY_LABELS } from "@/lib/utils";`

### Phase 3: Add category chip to TopicCard (~8 lines)
**File:** `src/components/TopicCard.tsx`
**Changes:**
1. Add import: `import { changeColor, formatChange, CATEGORY_LABELS } from "@/lib/utils";`
2. Add category chip below the urgency badge in the header row. After the `UrgencyBadge`, add:
```tsx
<span className="text-xs px-2 py-0.5 rounded-full text-stone-400 bg-stone-100 dark:bg-gray-800 dark:text-gray-500" data-testid="category-chip">
  {CATEGORY_LABELS[topic.category]}
</span>
```
3. Wrap UrgencyBadge + category chip in a flex container with `gap-1.5 flex-wrap` so they wrap if the topic name is long, keeping the existing `items-start justify-between` layout intact.

### Phase 4: Update tests (~15 lines)
**File:** `tests/TopicCard.test.tsx`
**Changes:**
1. Add test: category chip renders with human-readable label
2. Verify `data-testid="category-chip"` contains expected text (e.g., "Air Quality" for `air_quality`)

**File:** `tests/TopicGrid.test.tsx`
**Changes:**
1. Verify existing tests still pass (CATEGORY_LABELS import changed but behavior identical)

### Phase 5: Verify & Validate
1. Run `npx jest tests/TopicCard.test.tsx tests/TopicGrid.test.tsx` — all pass
2. Run `npx jest` — full suite passes
3. Run `npm run build` — no TypeScript errors
4. Visual check: category chip appears muted below urgency badge, card height unchanged

---

## User Journeys
### Journey 1: Dashboard Visitor — scanning the grid
1. User opens the dashboard
2. Sees grid of topic cards, each with urgency badge and a smaller muted category chip
3. Quickly identifies "Air Quality" vs "Ocean" vs "Biodiversity" topics without clicking
4. Uses this to mentally group topics by domain

---

## Files Changed Summary
| File | Action | Est. Lines |
|------|--------|-----------|
| `src/lib/utils.ts` | Add CATEGORY_LABELS export | +14 |
| `src/components/TopicGrid.tsx` | Remove local CATEGORY_LABELS, import from utils | -12, +1 |
| `src/components/TopicCard.tsx` | Add category chip + import | +6 |
| `tests/TopicCard.test.tsx` | Add category chip test | +10 |

## Risks
- Flex wrapping on very narrow mobile screens with long topic names — mitigated by using `flex-wrap` and small chip sizing
- Import path change in TopicGrid could break if other files import CATEGORY_LABELS from there — grep confirms no other imports exist

## Definition of Done
- [ ] CATEGORY_LABELS extracted to `src/lib/utils.ts`
- [ ] TopicGrid imports from shared location (no behavior change)
- [ ] Category chip renders on every TopicCard with muted styling
- [ ] Category chip is visually smaller/lighter than urgency badge
- [ ] Card height does not increase for standard-length topic names
- [ ] All existing tests pass
- [ ] New test verifies category chip renders correct label
- [ ] Build passes with no TypeScript errors
