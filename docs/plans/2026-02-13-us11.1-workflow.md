# US-11.1 Implementation Workflow: GDPR-Compliant Data Policy Page

**Date:** 2026-02-13
**Story:** US-11.1 — Display a GDPR-compliant data policy page
**Persona:** European visitor
**Branch:** `v2`
**Dependencies:** None (Footer component may be created by US-2.2; if not, create it here)
**Complexity:** S

---

## Current State Analysis

### What Exists

- **GDPR compliance already implemented**: IP truncation (last octet removed) in `src/lib/audit-log.ts`, `user_agent` removed from schema, no cookies, no accounts, no third-party trackers.
- **Audit log 90-day auto-purge**: Ready for implementation in batch script (not yet active, but the policy can reference it).
- **No `/data-policy` route** exists.
- **No footer component** exists yet (US-2.2 creates one; if implemented first, this story reuses it; if not, this story creates it).
- **Root layout** (`src/app/layout.tsx`): No footer links currently.

### Problems to Solve / Key Design Decisions

1. **Pure static page**: Server component with no client JS. Content is entirely static text and tables.
2. **Footer link dependency**: If US-2.2 is implemented first, the Footer already has a "Data Policy" link. If this story is implemented first, we need to create the Footer (or at minimum add the link to the layout).
3. **Last-updated date**: Hard-code the initial date. Future updates will manually change it.
4. **Contact information placeholder**: Use a generic placeholder that can be updated with real contact details before launch.

---

## Target State

- `/data-policy` page renders a GDPR Article 13-compliant data policy in plain English.
- 7 sections covering: what we collect, what we don't, legal basis, rights, retention, controller, changes.
- Linked from the site footer on every page.
- Proper SEO metadata.

---

## Implementation Phases

### Phase 1: Data Policy Page (~120 lines)

**File:** `src/app/data-policy/page.tsx`

**Changes:**

1. Create server component with metadata:

```tsx
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "Data Policy — EcoTicker",
  description: "What data EcoTicker collects, how it's used, and your rights under GDPR.",
};
```

2. Page body with 7 sections:

   **Section 1: What We Collect** — Plain-language HTML table:
   ```tsx
   <table>
     <thead><tr><th>Data</th><th>Where</th><th>Why</th><th>Retained</th></tr></thead>
     <tbody>
       <tr><td>Truncated IP addresses</td><td>Audit logs</td><td>Abuse prevention</td><td>90 days</td></tr>
       <tr><td>Page view counts</td><td>Topic analytics</td><td>Understanding which topics matter</td><td>Indefinite (no PII)</td></tr>
       <tr><td>Feedback text</td><td>Score feedback form</td><td>Improving scoring accuracy</td><td>Indefinite (no PII)</td></tr>
       <tr><td>Theme preference</td><td>Your browser (localStorage)</td><td>Remembering light/dark mode</td><td>Until you clear browser data</td></tr>
     </tbody>
   </table>
   ```

   **Section 2: What We Don't Collect** — Bullet list: no cookies, no accounts, no email addresses, no tracking pixels, no browser fingerprinting, no data sold to third parties.

   **Section 3: Legal Basis** — Legitimate interest under GDPR Article 6(1)(f) for truncated IP storage for abuse prevention. Explanation that truncated IPs are not considered personal data by most DPAs but we apply GDPR protections regardless.

   **Section 4: Your Rights** — Under GDPR Articles 15, 17, and 21: right to access, right to deletion, right to object. Contact email for exercising rights.

   **Section 5: Data Retention** — Audit logs purged after 90 days. Aggregated analytics (no PII) retained indefinitely. Theme preference stored only in the user's browser.

   **Section 6: Data Controller** — Placeholder contact information with name and email.

   **Section 7: Changes to This Policy** — Statement that changes will be posted on this page with an updated date. Last updated: 2026-02-13.

3. Back link to dashboard:
```tsx
<Link href="/" className="text-sm text-blue-600 dark:text-blue-400 hover:underline">
  ← Back to Dashboard
</Link>
```

4. Styling: Use the same warm cream/beige light and dark theme classes as the rest of the app. Prose-like layout with `max-w-3xl mx-auto` for readability.

### Phase 2: Footer Link (conditional, ~5 lines)

**File:** `src/components/Footer.tsx` (create if not exists, modify if US-2.2 already created it)

**Changes:**

1. If Footer does not exist yet, create a minimal footer with the "Data Policy" link:

```tsx
import Link from "next/link";

export default function Footer() {
  return (
    <footer className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 mt-8 border-t border-stone-200 dark:border-gray-800">
      <div className="flex flex-wrap gap-4 text-sm text-stone-500 dark:text-gray-400">
        <Link href="/data-policy" className="hover:text-stone-700 dark:hover:text-gray-200">
          Data Policy
        </Link>
      </div>
      <p className="mt-2 text-xs text-stone-400 dark:text-gray-500">
        © {new Date().getFullYear()} EcoTicker
      </p>
    </footer>
  );
}
```

2. If Footer already exists (from US-2.2), verify the "Data Policy" link is present — it should already be there per the US-2.2 plan.

**File:** `src/app/layout.tsx`

**Changes:**

3. If Footer is not yet imported in layout, add it after `</main>`:
```tsx
import Footer from "@/components/Footer";
```

### Phase 3: Tests (~40 lines)

**File:** `tests/data-policy-page.test.tsx`

**Changes:**

1. Test that the page renders all 7 section headings
2. Test that the data collection table contains expected rows (truncated IPs, page views, feedback, theme)
3. Test that "What We Don't Collect" lists no cookies, no accounts, etc.
4. Test metadata export values (title, description)
5. Test back-to-dashboard link
6. Test last-updated date is present

**File:** `tests/Footer.test.tsx` (create if not exists from US-2.2)

**Changes:**

7. Test that footer contains "Data Policy" link pointing to `/data-policy`

### Phase 4: Verify & Validate

1. `npx tsc --noEmit` — no type errors
2. `npm run build` — successful build
3. `npx jest` — all tests pass
4. Manual check: `/data-policy` renders all 7 sections in plain English
5. Manual check: footer "Data Policy" link visible on all pages
6. Manual check: dark mode renders correctly
7. Manual check: SEO meta tags present in page source

---

## User Journeys

### Journey 1: European visitor — Wants to know what data is collected

1. Visitor sees "Data Policy" link in the footer of any page
2. Clicks through to `/data-policy`
3. Reads the plain-language table of collected data
4. Notes that only truncated IPs are stored and only for 90 days
5. Sees "What We Don't Collect" — no cookies, no tracking, no accounts
6. Feels confident the service respects privacy

### Journey 2: European visitor — Wants to exercise GDPR rights

1. Visitor navigates to `/data-policy`
2. Scrolls to "Your Rights" section
3. Sees clear explanation of access, deletion, and objection rights
4. Finds contact email for data controller
5. Sends a request to exercise their rights

---

## Files Changed Summary

| File | Action | Est. Lines |
|---|---|---|
| `src/app/data-policy/page.tsx` | Create | ~120 |
| `src/components/Footer.tsx` | Create (or verify if exists) | ~20 |
| `src/app/layout.tsx` | Modify (if Footer not yet added) | ~3 |
| `tests/data-policy-page.test.tsx` | Create | ~40 |
| `tests/Footer.test.tsx` | Create (or verify if exists) | ~15 |
| **Total** | | **~198** |

## Risks

1. **Footer duplication**: If US-2.2 and US-11.1 are implemented in parallel on separate branches, both may create the Footer component. Resolve by implementing one first or coordinating the Footer creation.
2. **Legal accuracy**: The GDPR text is written in plain English but should be reviewed by someone with GDPR knowledge before EU launch. The placeholder contact info must be replaced with real details.
3. **Missing data flows**: If new data collection is added in future stories (e.g., feedback forms), this page must be updated to reflect it.

## Definition of Done

- [ ] `/data-policy` page renders all 7 GDPR Article 13 sections
- [ ] Data collection table lists all 4 data types with where/why/retention
- [ ] "What We Don't Collect" section lists all exclusions
- [ ] Legal basis, rights, retention, controller, and changes sections present
- [ ] Last-updated date displayed
- [ ] Footer "Data Policy" link visible on all pages
- [ ] Proper `<title>` and `<meta description>` tags
- [ ] All new and existing tests pass
- [ ] `npm run build` succeeds with no type errors
- [ ] Dark mode renders correctly
