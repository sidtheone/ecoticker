# US-2.2 Implementation Workflow: Scoring Methodology Page & Tooltip

**Date:** 2026-02-13
**Story:** US-2.2 — Understand the scoring methodology
**Persona:** First-time visitor
**Branch:** `v2`
**Dependencies:** US-1.1 (DONE)
**Complexity:** M (two deliverables: tooltip component + /scoring page)

---

## Current State Analysis

### What Exists

- **TopicCard** (`src/components/TopicCard.tsx`): Shows score as a large number with color coding and urgency badge. No info icon or tooltip explaining what the score means.
- **Topic detail page** (`src/app/topic/[slug]/page.tsx`): Client component with sub-score breakdown (eco/health/econ bars, levels, reasoning). No "?" icon or methodology link.
- **Root layout** (`src/app/layout.tsx`): Has TickerBar header, ThemeToggle, RefreshButton. No footer component exists.
- **Scoring logic** (`src/lib/scoring.ts`): Contains the 4-level rubric, weights, and aggregation logic — source of truth for the methodology page content.
- **No `/scoring` route** exists.
- **No footer component** exists (needed for "Learn more" and later for data-policy link in US-11.1).

### Problems to Solve / Key Design Decisions

1. **Tooltip approach**: Use a lightweight CSS-only tooltip (no JS library) to keep the scoring page as a server component. The TopicCard is already a client component (it's inside a Link), but the tooltip itself can be pure CSS with `:hover` and `:focus`.
2. **Mobile tap**: CSS `:hover` doesn't work on mobile. Use `:focus-within` on a `<button>` element so tapping opens the tooltip and tapping elsewhere dismisses it.
3. **Footer placement**: Add a `<Footer>` server component to `layout.tsx` below `<main>`. This footer will also be used by US-11.1 for the data-policy link.
4. **ScoreInfoIcon as shared component**: Used in both TopicCard (dashboard) and topic detail page, so extract to its own component.
5. **SEO**: The `/scoring` page is a server component with static metadata export — no client JS needed.

---

## Target State

- A `ScoreInfoIcon` component renders a small "?" button. On hover/focus, it shows a compact tooltip with the 4-level scale and a "Learn more" link to `/scoring`.
- The `/scoring` page is a static server component with 7 sections covering the full methodology.
- A `Footer` component appears on every page with links to `/scoring` and (future) `/data-policy`.
- Proper SEO metadata on the `/scoring` page.

---

## Implementation Phases

### Phase 1: ScoreInfoIcon Tooltip Component (~60 lines)

**File:** `src/components/ScoreInfoIcon.tsx`

**Changes:**

1. Create a new client component (needs `onClick` for mobile dismiss):

```tsx
"use client";

export default function ScoreInfoIcon() {
  return (
    <span className="relative inline-block group">
      <button
        type="button"
        className="w-5 h-5 rounded-full bg-stone-300 dark:bg-gray-700 text-stone-600 dark:text-gray-300 text-xs font-bold leading-none hover:bg-stone-400 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-stone-400"
        aria-label="Scoring methodology"
      >
        ?
      </button>
      <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 rounded-lg bg-white dark:bg-gray-800 border border-stone-200 dark:border-gray-700 shadow-lg text-xs text-stone-700 dark:text-gray-200 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto transition-opacity z-50">
        <p className="font-semibold mb-1">Severity Scale</p>
        <ul className="space-y-0.5">
          <li><span className="text-red-500 font-bold">76-100</span> SEVERE</li>
          <li><span className="text-orange-500 font-bold">51-75</span> SIGNIFICANT</li>
          <li><span className="text-yellow-500 font-bold">26-50</span> MODERATE</li>
          <li><span className="text-green-500 font-bold">0-25</span> MINIMAL</li>
        </ul>
        <a href="/scoring" className="block mt-2 text-blue-600 dark:text-blue-400 hover:underline">
          Learn more about our scoring →
        </a>
      </div>
    </span>
  );
}
```

### Phase 2: Integrate ScoreInfoIcon into TopicCard and Topic Detail (~10 lines)

**File:** `src/components/TopicCard.tsx`

**Changes:**

1. Import `ScoreInfoIcon`:
```tsx
import ScoreInfoIcon from "./ScoreInfoIcon";
```

2. Add the icon next to the score display (inside the score `<div>`, after the change span):
```tsx
<span className={`text-3xl font-bold ${scoreColor}`} data-testid="score">
  {topic.currentScore}
</span>
<span className={`ml-2 text-sm font-medium ${changeColor(topic.change)}`} data-testid="change">
  {formatChange(topic.change)}
</span>
<span className="ml-1"><ScoreInfoIcon /></span>
```

3. Prevent tooltip click from navigating (the card is wrapped in `<Link>`). Add `onClick={e => e.preventDefault()}` on the ScoreInfoIcon button, or wrap the icon with `e.stopPropagation()`. Handle this in `ScoreInfoIcon` via `onClick`:
```tsx
<button onClick={(e) => e.stopPropagation()} ...>
```

**File:** `src/app/topic/[slug]/page.tsx`

**Changes:**

4. Import `ScoreInfoIcon` and add it next to the overall score display.

### Phase 3: Footer Component (~30 lines)

**File:** `src/components/Footer.tsx`

**Changes:**

1. Create a server component:

```tsx
import Link from "next/link";

export default function Footer() {
  return (
    <footer className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 mt-8 border-t border-stone-200 dark:border-gray-800">
      <div className="flex flex-wrap gap-4 text-sm text-stone-500 dark:text-gray-400">
        <Link href="/scoring" className="hover:text-stone-700 dark:hover:text-gray-200">
          Scoring Methodology
        </Link>
        <Link href="/data-policy" className="hover:text-stone-700 dark:hover:text-gray-200">
          Data Policy
        </Link>
      </div>
      <p className="mt-2 text-xs text-stone-400 dark:text-gray-500">
        © {new Date().getFullYear()} EcoTicker
      </p>
    </footer>
  );
}
```

**File:** `src/app/layout.tsx`

**Changes:**

2. Import and render `<Footer />` after `</main>` inside the ThemeProvider:

```tsx
import Footer from "@/components/Footer";
// ...
          </main>
          <Footer />
        </ThemeProvider>
```

### Phase 4: Scoring Methodology Page (~150 lines)

**File:** `src/app/scoring/page.tsx`

**Changes:**

1. Create the static server component page with metadata export:

```tsx
import type { Metadata } from "next";
import Link from "next/link";

export const metadata: Metadata = {
  title: "Scoring Methodology — EcoTicker",
  description: "How EcoTicker calculates environmental impact severity scores using a 4-level rubric across ecological, health, and economic dimensions.",
  openGraph: {
    title: "Scoring Methodology — EcoTicker",
    description: "How EcoTicker calculates environmental impact severity scores.",
  },
};
```

2. Page body with 7 sections:
   - Section 1: **The 4-Level Severity Scale** — Table with level name, score range, criteria, real-world anchor examples
   - Section 2: **Three Dimensions** — Eco (40%), Health (35%), Econ (25%) with descriptions
   - Section 3: **Why These Weights** — Brief rationale (ecological damage is hardest to reverse, health is direct human impact, economic is downstream)
   - Section 4: **How the Overall Score Works** — Weighted average formula: `Score = (Eco × 0.40) + (Health × 0.35) + (Econ × 0.25)`
   - Section 5: **Urgency Levels** — Table mapping score ranges to badge colors (breaking/critical/moderate/informational)
   - Section 6: **Data Sources** — Articles collected daily from news sources and analyzed using large language models
   - Section 7: **Limitations** — Honest disclaimer about LLM limitations, news source bias, scoring subjectivity

3. Back link to dashboard at top:
```tsx
<Link href="/" className="text-sm text-blue-600 dark:text-blue-400 hover:underline">
  ← Back to Dashboard
</Link>
```

### Phase 5: Tests (~80 lines)

**File:** `tests/ScoreInfoIcon.test.tsx`

**Changes:**

1. Test that the "?" button renders
2. Test that tooltip contains all 4 severity levels
3. Test that "Learn more" link points to `/scoring`
4. Test `aria-label` for accessibility

**File:** `tests/Footer.test.tsx`

**Changes:**

5. Test that footer renders scoring and data-policy links
6. Test copyright year

**File:** `tests/scoring-page.test.tsx`

**Changes:**

7. Test that the `/scoring` page renders all 7 section headings
8. Test metadata export values
9. Test back-to-dashboard link

**File:** `tests/TopicCard.test.tsx` (existing)

**Changes:**

10. Update snapshot/assertion to account for the new ScoreInfoIcon in TopicCard

### Phase 6: Verify & Validate

1. `npx tsc --noEmit` — no type errors
2. `npm run build` — successful build
3. `npx jest` — all tests pass (existing + new)
4. Manual check: hover tooltip on desktop, tap on mobile
5. Manual check: `/scoring` page renders all sections, SEO meta tags present
6. Manual check: footer links work from all pages

---

## User Journeys

### Journey 1: First-time visitor — Sees a score and wants to understand it

1. Visitor lands on the dashboard, sees topic cards with scores like "82" in red
2. Notices the small "?" icon next to the score
3. Hovers over it (desktop) — tooltip appears with SEVERE/SIGNIFICANT/MODERATE/MINIMAL scale
4. Clicks "Learn more about our scoring →" — navigates to `/scoring`
5. Reads the full methodology including weights, formula, and limitations
6. Clicks "← Back to Dashboard" to return

### Journey 2: First-time visitor — Finds methodology from footer

1. Visitor scrolls to the bottom of any page
2. Sees "Scoring Methodology" link in the footer
3. Clicks through to `/scoring` and reads the explanation

### Journey 3: Mobile user — Taps the info icon

1. User taps the "?" button on a TopicCard
2. Tooltip appears (via `:focus-within`)
3. Taps elsewhere to dismiss
4. Taps "Learn more" link in tooltip to navigate to `/scoring`

---

## Files Changed Summary

| File | Action | Est. Lines |
|---|---|---|
| `src/components/ScoreInfoIcon.tsx` | Create | ~60 |
| `src/components/TopicCard.tsx` | Modify | ~5 |
| `src/app/topic/[slug]/page.tsx` | Modify | ~5 |
| `src/components/Footer.tsx` | Create | ~30 |
| `src/app/layout.tsx` | Modify | ~3 |
| `src/app/scoring/page.tsx` | Create | ~150 |
| `tests/ScoreInfoIcon.test.tsx` | Create | ~30 |
| `tests/Footer.test.tsx` | Create | ~20 |
| `tests/scoring-page.test.tsx` | Create | ~30 |
| `tests/TopicCard.test.tsx` | Modify | ~5 |
| **Total** | | **~338** |

## Risks

1. **Tooltip z-index conflicts**: The TopicCard is a clickable `<Link>`. The tooltip must intercept clicks (`stopPropagation`) to prevent navigation when interacting with the tooltip. Test on both desktop and mobile.
2. **Tooltip positioning edge cases**: Cards near viewport edges may cause the tooltip to overflow. Use `left-1/2 -translate-x-1/2` centering and consider adding `bottom-full` positioning. If problematic, add viewport-aware repositioning in a follow-up.
3. **Footer layout shift**: Adding a footer to every page may affect existing page layouts. Verify no visual regressions on dashboard and topic detail pages.

## Definition of Done

- [ ] "?" icon visible next to score on TopicCard (dashboard) and topic detail page
- [ ] Tooltip shows 4-level scale on hover (desktop) and tap (mobile)
- [ ] Tooltip "Learn more" link navigates to `/scoring`
- [ ] `/scoring` page renders all 7 sections with correct content
- [ ] `/scoring` page has proper `<title>`, `<meta description>`, and Open Graph tags
- [ ] Footer component renders on all pages with "Scoring Methodology" and "Data Policy" links
- [ ] All new and existing tests pass
- [ ] `npm run build` succeeds with no type errors
- [ ] Manual verification on desktop and mobile viewports
